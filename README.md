# Ssd1_CRACanalysis_2020

This repository contains extended data for the manuscript:

> Yeast Ssd1 is a non-enzymatic member of the RNase II family with an alternative RNA recognition interface
> Rosemary A. Bayne, Uma Jayachandran, Aleksandra Kasprowicz, Stefan Bresson, David Tollevey, Edward Wallace, and Atlanta G. Cook

This repository concentrates on analysis of CRAC data on yeast Ssd1, 2020.
The raw CRAC data will be archived on Gene Expression Omnibus shortly.

Please address questions to Edward.Wallace@ed.ac.uk. 

Structural data is available on PDB, not here.

# Overview - The pipeline for CRAC read processing

The main data here is CRAC, an Illumina short-read protocol related to HITS-CLIP, that detects RNA crosslinking sites for specific proteins. 
We analyse CRAC data using python script, [src/CRAC_pipeline_SE_demult_dedup.py](src/CRAC_pipeline_SE_demult_dedup.py).
This script uses the [ruffus](https://cgat-ruffus.readthedocs.io/) computational pipeline library to organise running of many 3rd-party tools.
This script was based on an earlier version by [Sander Granneman](), and makes extensive use of his [pyCRAC](software).

This repository is "as self--contained as possible". Most files are kept locally, with the exception of the 
* .fastq data (very large) - stored on GEO
* .novoindex aligner index (large) - created from the genome sequence in `input_annotation`

The pipeline reads as inputs:

* one multiplexed .fastq file with all raw reads 
* annotation files, in `input_annotation`
* barcode files, in `input_barcodes`

The pipeline writes as outputs:

* demultiplexed reads in .fastq format (also stored on GEO)
* various intermediate files of trimmed or unsorted reads (very large, not stored)
* reads aligned to the genome and sorted, in .bam format (very large, not stored in repository)
* read counts for each annotated transcript, in a .gff-like format
* pileups of local read density on the genome in .bedgraph format
* locations and hit counts for peaks in the CRAC data, in a .gff-like format

To run the pipeline as used in our paper, use this code:

```
python src/CRAC_pipeline_SE_demult_dedup.py \
  -f /homes/ewallac2/mount/datastore/wallace_rna/bigdata/2019/Ssd1CRAC-2019-01-15/20190114_Ssd1_CRAC.fastq  \
  -c input_annotation/Saccharomyces_cerevisiae.EF4.74.dna.toplevel.shortChrNames.lengths \
  --gtf input_annotation/Saccharomyces_cerevisiae.EF4.74_SGDv64_CUTandSUT_withUTRs_noEstimates_antisense_intergenic_4xlncRNAs_final.pyCheckGTFfile.output.quotefix.gtf \
  --novoindex /homes/rbayne2/CRACAnalysisJan2019_1/Saccharomyces_cerevisiae.EF4.74.dna.toplevel.shortChrNames.novoindex \
  -p 5 \
  --name Ssd1_CRAC_demult_dedup_20190114_all \
  -a input_barcodes/3primeadapter.fasta \
  -b input_barcodes/Ssd1CRACSampleBarcodes.txt \
  --genelist input_annotation/Ssd1TargetGeneNamesOnly.txt \
  --genometab input_annotation/Saccharomyces_cerevisiae.EF4.74.dna.toplevel.shortChrNames.fa.tab \
  --transcriptgff input_annotation/abundant_verified_full-ORF_ypd_plus_other_fixed_UTR_length_transcripts.gff
```

Unfortunately, due to a bug we have not yet been able to fix, this needs to be run *twice* for all tasks to complete.

# Organisation of this repository

Data and code is organised into subdirectories, whose contents are briefly mentioned in this section.
Each directory has its own README file that describes the contents in more detail.

## src

Source code that runs the pipeline, `CRAC_pipeline_SE_demult_dedup.py`.

## input_annotation

Annotation files (genome sequence, transcript maps) needed to run pipeline on S288C yeast.

## input_barcodes

Sequencing adapters and barcodes needed to run pipeline.

## Ssd1_CRAC_demult_dedup_20190114_all

This contains all the outputs generated by `CRAC_pipeline_SE_demult_dedup.py`.

## input_targets

Published data on Ssd1 targets from other studies.
Because these data are relatively large and publicly available, we did not directly include them in the repository.

They can be downloaded from the links in `input_targets/README.md`.

## rmarkdown

Analysis scripts in rmarkdown (Rmd) format, that produce many figures in the manuscript.
These run *after* the CRAC pipeline has completed.

## figure_out

Figures that are used for the manuscript, output from scripts in `rmarkdown`.

## results

Tabular data and other results generated by scripts in directory `rmarkdown`. 
